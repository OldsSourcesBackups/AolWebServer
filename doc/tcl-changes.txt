
About Tcl and AOLserver
-----------------------

As of Tcl version 8.4 and AOLserver 4.0, no modifications are
required to the Tcl core sources to support AOLserver.  Note:

o       AOLserver requires thread-enabled Tcl which is generally
not the default configuration installed on most hosts.

o       Tcl source is no longer included with the AOLserver source
distribition.  Download or cvs checkout from SourceForge at
tcl.sourceforge.net and set the location with the ${tcldir} variable
in AOLserver's include/Makefile.module.  The default is ../tcl8.4.,
i.e., at the same level as your AOLserver source directory.

o       After downloading Tcl, it's still easiest to start the
build from the AOLserver source directory.  This is because
AOLserver's Makefile passes the correct configure flags (e.g.,
--enable-threads) to support AOLserver in debug and optimized
builds.

o       AOLserver by default builds Tcl as a dynamic library instead
of a static library linked into nsd.  The benfit is that the entire
Tcl API is available to AOLserver modules whether nsd requires them
or not.  The Tcl and AOLserver makefiles attempt to ensure nsd
finds the thread-enabled Tcl library in the AOLserver install
directory (i.e., /usr/local/aolserver/lib) via platform-dependent
means (e.g., the various -rpath and -install_name flags).

o       All known multithreading code and configuration bug fixes
previously in the modified Tcl sources distributed with AOLserver
have been incorporated into the Tcl core directly.

o       The fast multithreading memory allocator developed in
AOLserver 3.x (the "zippy" allocator) has been integrated as the
default Tcl allocator for threaded Unix builds.  The code includes
the Tcl_GetMemoryInfo API used by the ns_info AOLserver Tcl command
to dump thread bucket stats.

NOTE:  The zippy allocator when built into Tcl (the default) will
then be used in AOLserver regardless of the AOLserver 3.x -z flag
which is now ignored.  As before, do not mix malloc/ckalloc/ns_malloc
ana free/ckfree/ns_free when this allocator is used.

o       Tcl and AOLserver can now be compiled with TCL_MEM_DEBUG
to assist in trapping common dynamic memory errors.  However, it
must be enabled when building both Tcl and AOLserver which can be
done easily by uncommenting the ${tclmemdbg} var in AOLserver's
include/Makefile.global.  Also, this options adds significant
overhead to memory allocation operations and negates the performance
benefits of the zippy allocator so it may not work well for you in
production.

o       Tcl version 7.6 is no longer supported, eliminating some
of the confusing dual-version code and feature compromises in
AOLserver 3.x.  As before with AOLserver 3.x and Tcl 8.x (i.e.,
when using the nsd8x binary), Tcl and AOLserver manipulate scripts
internally as Utf-8.  If you only used Tcl 7.6 in AOLserver 3.x,
moving to AOLserver 4.0 with Tcl 8.4 should not be an issue unless
you used extended characters in your scripts (e.g., accents, tildes,
etc.) Check the Tcl resources at tcl.sourceforge.net for details
on upgrading from Tcl 7.x.


Thanks to Jeff Hobbs of ActiveState for integrating our fixes and
fast memory allocator to free us from maintaining our hacked Tcl
sources.

-Jim (jgdavidson@aol.com)
Sat Jun  8 12:57:37 EDT 2002
